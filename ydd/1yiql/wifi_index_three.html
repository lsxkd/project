<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="./css/public_reset.css" type="text/css" />
        <link rel="stylesheet"  href="./css/public_frame.css" type="text/css"/>
        <link rel="stylesheet"  href="./css/public_style.css" type="text/css"/>
        <link rel="stylesheet"  href="css/wifi.css" type="text/css"/>

        <title>亿企联</title> 
        <script  type="text/javascript" src="./js/jquery.js"></script>  
        <script type="text/javascript">
            $(function(){
                $("#labels_top").load("top.html");
                $("#labels_footer").load("footer.html");
            });
        </script>       
	</head>
<body>
<!--top start-->
<div id="labels_top"></div>
<!--top end-->
<div class="wifi_bg">
  <div class="wifi_register_content">
      <div class="wifi_nav">
      	<div class="wifi_nav_step_box wifi_nav_step_box_three">
          	<div class="wifi_nav_step_box_font">1 店铺信息</div>
              <div class="wifi_nav_step_box_font">2 添加设备</div>
              <div class="wifi_nav_step_box_font wifi_nav_step_box_font_color">3 下载连网二维码</div>
          </div>
      </div>
      <div class="wifi_perfect_information">
      	<div class="wifi_perfect_information_box">
              <!--first of perfect_information  start-->
              <div class="wifi_information_first">
                 <div class="wifi_index_three">
                     <p class="wifi_index_three_p">
                         打印以下二维码并于店内张贴。请确保有人（顾客或店员）用<em class="fontss_blue">6.1以上安卓版微信</em>或<em class="fontss_blue">6.2.2以上IOS版微信</em>扫码连接WiFi，连网成功即表示设备添加成功。
                     </p>
                     <div class="wifi_index_three_con">
                        <!-- 墙贴 start -->
                        <div class="material_download_three_cons">
                          <div class="material_download_three_cons_con">
                          <!-- left -->
                            <div class="material_download_three_cons_con_item">
                              <div class="material_download_three_cons_con_item_box">
                                <div class="material_download_three_cons_con_item_l walls_three_item">
                                  <h2 class="walls_three_item_h2s">深圳市南山区芒果网大厦商店</h2>
                                  <img src="../resources/images/activity/1451888006.png">
                                  <span class="material_download_three_cons_con_item_l_span">WX-NAME</span>
                                </div>
                              </div>
                            </div>
                            <!-- left -->
                          </div>
                        </div>
                        <!-- 墙贴 end -->
                         <div class="wifi_index_three_con_fontss">
                            <p>墙贴 21cm*29cm (A4纸大小)</p>
                            <p><a href="javascript:void(0);">更多尺寸下载</a></p>
                         </div>
                     </div>

                      <canvas id="myCanvas" width=280 height=390 style='display:none'></canvas>
                      <img src="../resources/images/erweima.png" id="myImg" style="display:none">
  
                      <p class="wifi_index_three_con_tips">
                      备注：请下载物料并张贴于门店内  你也可以立即扫码体验连网流程
                      </p>
                 </div>
              </div>
              <!--first of perfect_information end-->

          </div>
          <div class="wifi_information_button">
          	<a class="wifi_information_button_last"  href="javscript:void(0);">完成</a>
          	<a class="wifi_information_button_next" id="myInput" href="javscript:void(0);">下载二维码</a>
          </div>    
    	</div>
  </div>
</div>
<!--footer start-->
<div id="labels_footer"></div>
<!--footer end-->
<img src="../resources/images/wifi/tags_door_15_15.png" id="doorImage"  style="display:none">
<img src="../resources/images/wifi/tags_door_push_10_19.png" id="doorPushImage"  style="display:none">
<img src="../resources/images/wifi/tags_door_pull_10_19.png" id="doorPullImage"  style="display:none">
<img src="../resources/images/wifi/wall_poster_A4.png" id="wallImage"  style="display:none">
<img src="../resources/images/wifi/desk_poster_10_10.png" id="deskImage"  style="display:none">
<img src="../resources/images/wifi/desk_poster_6_6.png" id="deskTwoImage"  style="display:none">
<p id="font_names" style="display:none">蓝色星空岛</p><!-- 二维码下面字体 -->
<p id="business_name" style="display:none">深圳市南山区芒果网大厦商店</p><!-- 二维码上面商户名称字体 -->

<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGEAAABgAgMAAABwNPSVAAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAAJUExURe3z+P///wAAAJ7KgtoAAAABYktHRAH/Ai3eAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAMnRFWHRSYXcgcHJvZmlsZSB0eXBlIGV4aWYACmV4aWYKICAgICAgIDYKNDU3ODY5NjYwMDAwCvm8oQ4AAAFDSURBVEjHrZbRkcMgDETTRPq5JsQHJdAPJfCBqjztCpO5XH68xOPJxHoMIquVnMfTPl8/D4k4rl5GPLVpzSqep0pmhGqPz+IOXnsEdFJ91l6wtyFD7ZH2kPhAHmeecxLh1GAeEmqAPMN8tH/q3CNZn9j+ut8qd4+kVcpo19nfXHWPsCbUEhrg4LFKJrntxN3wDat0Eoe1VfDGyrTiXSbZH7hRZ14j66OQSFJYooCMvbQWSOFJ04MMb0UlEnujzp1OtGzlqRKEQ8vLO77SymR5J0cCf4SZTGhAhluaceeRSLrPKAMge0UlUW0I4MvadOU8INvXaUZEVHL1HMJpH4ohkj2r4uyFMx5dqJKco+ka3+8NmSwJjT3XsocPCeXEEM1UdkqWd8paopJ8/7jvUVr+vs1ukV0fCDDM19wSyXf/I32T/AK3jEawV+mc8gAAAABJRU5ErkJggg==" id="doorEwmImage"  style="display:none">
<canvas id="doorCanvas"  style="display:none"></canvas>
<div id="aaaaa" style="display:none"></div>
<script>

function myCanvas(img,img2,x,y,width,height,canvasW,canvasH,font_left,fontss_y,businessName,fn){
  //img 背景图片地址
  //img2 二维码图片地址
  //x 二维码图片x坐标
  //y  二维码图片Y坐标
  //width 二维码图片宽度
  //height  二维码图片高度
  //canvasW canvas宽度
  //canvasH canvas高度
  //font_left  font_left宽度用来定位二维码下面字体X坐标
  //fontss_y  二维码下面字体Y坐标
  //business_name 二维码上面商户名称
  var doorcv = document.getElementById("doorCanvas");  
  doorcv.width= canvasW;
  doorcv.height= canvasH
  var doorctx = doorcv.getContext("2d");
  var doorImage = new Image();
  doorImage = document.getElementById(img)
  var doorEwmImage = new Image();
  doorEwmImage = document.getElementById(img2);

  doorctx.drawImage(doorImage, 0, 0);
  doorctx.drawImage(doorEwmImage, x, y,width,height);


  // 二维码下面字体 start
  var fontss = document.getElementById("font_names").innerHTML;
  var n = 0;
  for(var i=0 ; i<fontss.length;i++){
      if(/[\u4e00-\u9fff]/.test(fontss[i])){
          n+=2;
      }else if(/[a-zA-Z]/.test(fontss[i])){
          n++;
      }
  }
  if(n>10){
    n=10;
  }
  if(fontss.length>10){
    fontss = fontss.substring(0,10);
  }
  var fontss_x = (font_left-n*12)/2;                              
  
  doorctx.font = 'normal 24px 微软雅黑';
  doorctx.textAlign = 'left';
  doorctx.textBaseline = 'top';
  doorctx.fillStyle = '#20b5f7';
  doorctx.fillText(fontss, fontss_x, fontss_y);
  // 二维码下面字体  end

  //二维码上面商户名称字体 start

  if(businessName){
    var m = 0;
  for(var i=0 ; i<businessName.length;i++){
      if(/[\u4e00-\u9fff]/.test(businessName[i])){
          m+=2;
      }else if(/[a-zA-Z]/.test(businessName[i])){
          m++;
      }
  }
  var businessName_x = (font_left-m*44)/2;   
  doorctx.font = 'normal 88px 微软雅黑';
  doorctx.textAlign = 'left';
  doorctx.textBaseline = 'top';
  doorctx.fillStyle = '#e93719';
  doorctx.fillText(businessName, businessName_x, 80);
  }
  
  //二维码上面商户名称字体 end


  // 将canvas转换为图片；
  var type="png";
  imgData = doorcv.toDataURL(type);
  var _fixType = function(type) {
      type = type.toLowerCase().replace(/jpg/i, 'jpeg');
      var r = type.match(/png|jpeg|bmp|gif/)[0];
      return 'image/' + r;
  };
  imgData = imgData.replace(_fixType(type),'image/octet-stream');
  var saveFile = function(data, filename){
      var save_link = document.createElementNS('http://www.w3.org/1999/xhtml', 'a');
      save_link.href = data;
      save_link.download = filename;
      var event = document.createEvent('MouseEvents');
      event.initMouseEvent('click', true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
      save_link.dispatchEvent(event);
  };

  // 下载后的问题名
  
  var bd= new Image();
  bd.src=imgData;
  document.getElementById("aaaaa").appendChild(bd); 

}
window.onload=function(){
  myCanvas("wallImage","doorEwmImage",360,1200,1840,1840,2556,3592,2556,3030,"深圳市南山区芒果网大厦商店",function(){
    var array = [];
    $("#aaaaa img").each(function(){
      array.push($(this).prop("src"));    
    });
    $("#ewmsss img").each(function(){
      array.push($(this).prop("src"));    
    });
    console.log(array);
  });
}
</script>

</body>
</html>
